<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Mon Oct 20 2025 02:05:09 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="68d5fc11b55d1fc05f41ed8c" data-wf-site="68cecb820ec3dbdca3ef9099" lang="en">
<head>
  <meta charset="utf-8">
  <title>Analyze</title>
  <meta content="Analyze" property="og:title">
  <meta content="Analyze" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/new-real-estate-purchase.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Droid Serif:400,400italic,700,700italic","PT Serif:400,400italic,700,700italic","Bitter:400,700,400italic","Vollkorn:400,400italic,700,700italic","Varela:400","Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic","Great Vibes:400","DM Sans:300,regular,500,600,700","Gilda Display:regular","Barlow Condensed:regular","Barlow:300italic,regular,italic,500","Material Icons Outlined:regular","Material Icons:regular"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../images/favicon.svg" rel="shortcut icon" type="image/x-icon">
  <link href="../images/webclip.jpg" rel="apple-touch-icon">
</head>
<body class="body-6">
  <header class="style-two-header">
    <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-logo-left-container style-three-header-container w-nav">
      <div class="container-two">
        <div class="navbar-wrapper">
          <div class="style-three-nav-brand">
            <a href="#" role="link" class="home-three-nav-menu-brand rezoid w-nav-brand"><img src="../images/TOR.png" loading="lazy" width="122" height="25" alt="" srcset="../images/1394a00d76ce9dd861ade690dfb1a058_TOR-p-500.png 500w, ../images/1394a00d76ce9dd861ade690dfb1a058_TOR-p-800.png 800w, ../images/1394a00d76ce9dd861ade690dfb1a058_TOR-p-1080.png 1080w, ../images/1394a00d76ce9dd861ade690dfb1a058_TOR-p-1600.png 1600w, ../images/1394a00d76ce9dd861ade690dfb1a058_TOR-p-2000.png 2000w, ../images/1394a00d76ce9dd861ade690dfb1a058_TOR-p-2600.png 2600w, ../images/TOR.png 2851w" sizes="122px"></a>
          </div>
          <div class="w-layout-hflex nav-link-box">
            <div class="w-layout-hflex nav-one-button-wrap">
              <div class="menu-button w-nav-button"><img src="../images/Icon-nav-1.svg" loading="lazy" width="31" height="18" alt="Hambarger Menu"></div>
            </div>
          </div>
          <a role="link" data-w-id="0bce0368-0fe1-581a-dd23-1c4da305c7bd" href="tel:+1800456789" class="style-three-phone-button responsive-hidden w-inline-block">
            <div class="home-three-call-button-text">
              <div class="style-three-phone-button-txt">Lets Talk</div>
              <div class="style-three-phone-button-txt">(800) 456 7890</div>
            </div>
            <div class="home-three-button-icon"><img src="../images/Call-Icon.svg" loading="lazy" width="46" height="46" alt="Call Icon" class="image"></div>
          </a>
          <div class="navbar-wrapper-2">
            <div class="style-three-nav-brand">
              <a href="#" role="link" class="home-three-nav-menu-brand rezoid w-nav-brand"></a>
            </div>
            <div class="w-layout-hflex nav-link-box">
              <nav role="navigation" class="nav-menu-wrapper-3 w-nav-menu">
                <ul role="list" class="nav-menu-two w-list-unstyled">
                  <li class="list-item-3 nav-five-list">
                    <div data-delay="0" data-hover="true" data-w-id="3648297c-ddce-044b-87fb-9eff0b3055a7" class="home-three-dropdaown-2 w-dropdown">
                      <div class="style-three-menu-dropdown-toggle-3 w-dropdown-toggle">
                        <div class="home-three-dropdown">
                          <div class="home-three-dropdown-menu black-color">Home </div>
                          <div class="home-three-dropdown-menu black-color">Home </div>
                        </div><img width="9" height="9" alt="Plus" src="../images/Plus.svg" loading="lazy" class="home-three-dropdown-icon">
                      </div>
                      <nav class="home-three-dropdown-list w-dropdown-list">
                        <div class="home-three-dropdown-block">
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Home One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Home Two</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Home Three</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Home Four</a>
                        </div>
                      </nav>
                    </div>
                  </li>
                  <li class="list-item-3 nav-five-list">
                    <div data-delay="0" data-hover="true" data-w-id="3648297c-ddce-044b-87fb-9eff0b3055ba" class="home-three-dropdaown-2 w-dropdown">
                      <div class="style-three-menu-dropdown-toggle-3 w-dropdown-toggle">
                        <div class="home-three-dropdown">
                          <div class="home-three-dropdown-menu black-color">FEATURES</div>
                          <div class="home-three-dropdown-menu black-color">Properties</div>
                        </div><img width="9" height="9" alt="Plus" src="../images/Plus.svg" loading="lazy" class="home-three-dropdown-icon">
                      </div>
                      <nav class="home-three-dropdown-list w-dropdown-list">
                        <div class="home-three-dropdown-block">
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Property One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Property Two</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Property Three</a>
                          <a href="https://rezoid.webflow.io/properties/the-mertilex-complex-3" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Property Details One</a>
                          <a href="https://rezoid.webflow.io/property-two/house-block-renovate" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Property Details Two</a>
                        </div>
                      </nav>
                    </div>
                  </li>
                  <li class="list-item-3 nav-five-list">
                    <div data-delay="0" data-hover="true" data-w-id="3648297c-ddce-044b-87fb-9eff0b3055d2" class="home-three-dropdaown-2 w-dropdown">
                      <div class="style-three-menu-dropdown-toggle-3 w-dropdown-toggle">
                        <div class="home-three-dropdown">
                          <div class="home-three-dropdown-menu black-color">ABOUT US</div>
                          <div class="home-three-dropdown-menu black-color">Pages</div>
                        </div><img width="9" height="9" alt="Plus" src="../images/Plus.svg" loading="lazy" class="home-three-dropdown-icon">
                      </div>
                      <nav class="home-three-dropdown-list w-dropdown-list">
                        <div class="home-three-dropdown-block">
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">About One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">About Two</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">About Three</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Service One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Service Two</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Agent One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Agent Two</a>
                          <a href="https://rezoid.webflow.io/agent/francine-lawson" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Agent Details</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Listing Property</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Book Consultation</a>
                          <a href="https://rezoid.webflow.io/location/las-vegas" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Property Location</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">FAQ</a>
                          <a href="https://rezoid.webflow.io/search" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Search Result</a>
                          <a href="https://rezoid.webflow.io/information/licensing" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Licensing</a>
                          <a href="https://rezoid.webflow.io/information/style-guide" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Style Guide</a>
                          <a href="https://rezoid.webflow.io/404" role="link" class="home-three-dropdown-link-2 w-dropdown-link">404</a>
                          <a href="https://rezoid.webflow.io/401" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Password Protected</a>
                        </div>
                      </nav>
                    </div>
                  </li>
                  <li class="list-item-3 nav-five-list">
                    <div data-delay="0" data-hover="true" data-w-id="3648297c-ddce-044b-87fb-9eff0b3055ff" class="home-three-dropdaown-2 w-dropdown">
                      <div class="style-three-menu-dropdown-toggle-3 w-dropdown-toggle">
                        <div class="home-three-dropdown">
                          <div class="home-three-dropdown-menu black-color">Blog</div>
                          <div class="home-three-dropdown-menu black-color">Blog</div>
                        </div><img width="9" height="9" alt="Plus" src="../images/Plus.svg" loading="lazy" class="home-three-dropdown-icon">
                      </div>
                      <nav class="home-three-dropdown-list w-dropdown-list">
                        <div class="home-three-dropdown-block">
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Blog One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Blog Two</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Blog Three</a>
                          <a href="https://rezoid.webflow.io/blog/unlocking-home-ownership-your-ultimate-guide-to-buying-an-apartment" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Blog Details One</a>
                          <a href="https://rezoid.webflow.io/blog-two/unlocking-homeownership-your-ultimate-guide-to-buying-an-apartment" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Blog Details Two</a>
                        </div>
                      </nav>
                    </div>
                  </li>
                  <li class="list-item-3 nav-five-list">
                    <div data-delay="0" data-hover="true" data-w-id="3648297c-ddce-044b-87fb-9eff0b305614" class="home-three-dropdaown-2 w-dropdown">
                      <div class="style-three-menu-dropdown-toggle-3 w-dropdown-toggle">
                        <div class="home-three-dropdown">
                          <div class="home-three-dropdown-menu black-color">Contact</div>
                          <div class="home-three-dropdown-menu black-color">Contact</div>
                        </div><img width="9" height="9" alt="Plus" src="../images/Plus.svg" loading="lazy" class="home-three-dropdown-icon">
                      </div>
                      <nav class="home-three-dropdown-list w-dropdown-list">
                        <div class="home-three-dropdown-block">
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Contact One</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Contact Two</a>
                          <a href="#" role="link" class="home-three-dropdown-link-2 w-dropdown-link">Contact Three</a>
                        </div>
                      </nav>
                    </div>
                  </li>
                </ul>
              </nav>
              <div class="w-layout-hflex nav-one-button-wrap">
                <div data-open-product="" data-wf-cart-type="rightSidebar" data-wf-cart-query="" data-wf-page-link-href-prefix="" class="w-commerce-commercecartwrapper nav-one-card" data-node-type="commerce-cart-wrapper">
                  <a class="w-commerce-commercecartopenlink cart-button-2 w-inline-block" role="button" aria-haspopup="dialog" aria-label="Open cart" data-node-type="commerce-cart-open-link" href="#"><img width="23" height="26" alt="Caart Icon" src="../images/Card.svg" loading="lazy">
                    <div style="display:none" data-count-hide-rule="empty" class="w-commerce-commercecartopenlinkcount cart-quantity-2">0</div>
                  </a>
                  <div style="display:none" class="w-commerce-commercecartcontainerwrapper w-commerce-commercecartcontainerwrapper--cartType-rightSidebar" data-node-type="commerce-cart-container-wrapper">
                    <div data-node-type="commerce-cart-container" role="dialog" class="w-commerce-commercecartcontainer">
                      <div class="w-commerce-commercecartheader">
                        <h4 class="w-commerce-commercecartheading heading-four-2">Your Cart</h4>
                        <a class="w-commerce-commercecartcloselink w-inline-block" role="button" aria-label="Close cart" data-node-type="commerce-cart-close-link"><svg width="16px" height="16px" viewbox="0 0 16 16">
                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                              <g fill-rule="nonzero" fill="#333333">
                                <polygon points="6.23223305 8 0.616116524 13.6161165 2.38388348 15.3838835 8 9.76776695 13.6161165 15.3838835 15.3838835 13.6161165 9.76776695 8 15.3838835 2.38388348 13.6161165 0.616116524 8 6.23223305 2.38388348 0.616116524 0.616116524 2.38388348 6.23223305 8"></polygon>
                              </g>
                            </g>
                          </svg></a>
                      </div>
                      <div class="w-commerce-commercecartformwrapper">
                        <form style="display:none" class="w-commerce-commercecartform" data-node-type="commerce-cart-form">
                          <script type="text/x-wf-template" id="wf-template-3648297c-ddce-044b-87fb-9eff0b305632"></script>
                          <div class="w-commerce-commercecartlist" data-wf-collection="database.commerceOrder.userItems" data-wf-template-id="wf-template-3648297c-ddce-044b-87fb-9eff0b305632"></div>
                          <div class="w-commerce-commercecartfooter">
                            <div aria-live="polite" aria-atomic="true" class="w-commerce-commercecartlineitem">
                              <div>Subtotal</div>
                              <div class="w-commerce-commercecartordervalue text-monstaret"></div>
                            </div>
                            <div>
                              <div data-node-type="commerce-cart-quick-checkout-actions">
                                <a role="button" aria-haspopup="dialog" aria-label="Apple Pay" data-node-type="commerce-cart-apple-pay-button" style="background-image:-webkit-named-image(apple-pay-logo-white);background-size:100% 50%;background-position:50% 50%;background-repeat:no-repeat" class="w-commerce-commercecartapplepaybutton" tabindex="0">
                                  <div></div>
                                </a>
                                <a role="button" tabindex="0" aria-haspopup="dialog" data-node-type="commerce-cart-quick-checkout-button" style="display:none" class="w-commerce-commercecartquickcheckoutbutton"><svg class="w-commerce-commercequickcheckoutgoogleicon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" viewbox="0 0 16 16">
                                    <defs>
                                      <polygon id="google-mark-a" points="0 .329 3.494 .329 3.494 7.649 0 7.649"></polygon>
                                      <polygon id="google-mark-c" points=".894 0 13.169 0 13.169 6.443 .894 6.443"></polygon>
                                    </defs>
                                    <g fill="none" fill-rule="evenodd">
                                      <path fill="#4285F4" d="M10.5967,12.0469 L10.5967,14.0649 L13.1167,14.0649 C14.6047,12.6759 15.4577,10.6209 15.4577,8.1779 C15.4577,7.6339 15.4137,7.0889 15.3257,6.5559 L7.8887,6.5559 L7.8887,9.6329 L12.1507,9.6329 C11.9767,10.6119 11.4147,11.4899 10.5967,12.0469"></path>
                                      <path fill="#34A853" d="M7.8887,16 C10.0137,16 11.8107,15.289 13.1147,14.067 C13.1147,14.066 13.1157,14.065 13.1167,14.064 L10.5967,12.047 C10.5877,12.053 10.5807,12.061 10.5727,12.067 C9.8607,12.556 8.9507,12.833 7.8887,12.833 C5.8577,12.833 4.1387,11.457 3.4937,9.605 L0.8747,9.605 L0.8747,11.648 C2.2197,14.319 4.9287,16 7.8887,16"></path>
                                      <g transform="translate(0 4)">
                                        <mask id="google-mark-b" fill="#fff">
                                          <use xlink:href="#google-mark-a"></use>
                                        </mask>
                                        <path fill="#FBBC04" d="M3.4639,5.5337 C3.1369,4.5477 3.1359,3.4727 3.4609,2.4757 L3.4639,2.4777 C3.4679,2.4657 3.4749,2.4547 3.4789,2.4427 L3.4939,0.3287 L0.8939,0.3287 C0.8799,0.3577 0.8599,0.3827 0.8459,0.4117 C-0.2821,2.6667 -0.2821,5.3337 0.8459,7.5887 L0.8459,7.5997 C0.8549,7.6167 0.8659,7.6317 0.8749,7.6487 L3.4939,5.6057 C3.4849,5.5807 3.4729,5.5587 3.4639,5.5337" mask="url(#google-mark-b)"></path>
                                      </g>
                                      <mask id="google-mark-d" fill="#fff">
                                        <use xlink:href="#google-mark-c"></use>
                                      </mask>
                                      <path fill="#EA4335" d="M0.894,4.3291 L3.478,6.4431 C4.113,4.5611 5.843,3.1671 7.889,3.1671 C9.018,3.1451 10.102,3.5781 10.912,4.3671 L13.169,2.0781 C11.733,0.7231 9.85,-0.0219 7.889,0.0001 C4.941,0.0001 2.245,1.6791 0.894,4.3291" mask="url(#google-mark-d)"></path>
                                    </g>
                                  </svg><svg class="w-commerce-commercequickcheckoutmicrosofticon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewbox="0 0 16 16">
                                    <g fill="none" fill-rule="evenodd">
                                      <polygon fill="#F05022" points="7 7 1 7 1 1 7 1"></polygon>
                                      <polygon fill="#7DB902" points="15 7 9 7 9 1 15 1"></polygon>
                                      <polygon fill="#00A4EE" points="7 15 1 15 1 9 7 9"></polygon>
                                      <polygon fill="#FFB700" points="15 15 9 15 9 9 15 9"></polygon>
                                    </g>
                                  </svg>
                                  <div>Pay with browser.</div>
                                </a>
                              </div>
                              <a href="../checkout.html" value="Continue to Checkout" class="w-commerce-commercecartcheckoutbutton hero-button-3" data-loading-text="Hang Tight..." data-node-type="cart-checkout-button">Continue to Checkout</a>
                            </div>
                          </div>
                        </form>
                        <div class="w-commerce-commercecartemptystate">
                          <div aria-label="This cart is empty" aria-live="polite">No items found.</div>
                        </div>
                        <div aria-live="assertive" style="display:none" data-node-type="commerce-cart-error" class="w-commerce-commercecarterrorstate">
                          <div class="w-cart-error-msg" data-w-cart-quantity-error="Product is not available in this quantity." data-w-cart-general-error="Something went wrong when adding this item to the cart." data-w-cart-checkout-error="Checkout is disabled on this site." data-w-cart-cart_order_min-error="The order minimum was not met. Add more items to your cart to continue." data-w-cart-subscription_error-error="Before you purchase, please use your email invite to verify your address so we can send order updates.">Product is not available in this quantity.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <a href="#" role="button" data-w-id="3648297c-ddce-044b-87fb-9eff0b30565b" class="hero-button-3 nav-button w-inline-block">
                  <div class="button-mask">
                    <div class="link-text-wrp">
                      <div>Contact us</div>
                      <div class="secondt-btn-text">Contact us</div>
                    </div>
                  </div>
                </a>
                <div class="menu-button-2 w-nav-button"><img width="31" height="18" alt="Hambarger Menu" src="../images/Icon-nav-1.svg" loading="lazy"></div>
              </div>
            </div>
            <a role="link" data-w-id="3648297c-ddce-044b-87fb-9eff0b305664" href="tel:+1800456789" class="style-three-phone-button responsive-hidden w-inline-block">
              <div class="home-three-call-button-text">
                <div class="style-three-phone-button-txt">Lets Talk</div>
                <div class="style-three-phone-button-txt">(800) 456 7890</div>
              </div>
              <div class="home-three-button-icon"><img width="46" height="46" alt="Call Icon" src="../images/Call-Icon.svg" loading="lazy" class="image-71"></div>
            </a>
          </div>
        </div>
      </div>
    </div>
    <section></section>
  </header>
  <section class="section-139">
    <div data-w-id="a4c75c61-8f3a-341b-9701-a6c58bac8224" class="primary-glow-wrapper-2 full-width">
      <div class="button-overflow-hidden for--third-version-features full-size ai-child">
        <div>
          <div class="pedding-stroke">
            <div class="inside-button none-padding ai-child">
              <div class="principle-second-block ai-child"></div>
            </div>
          </div>
          <div class="glow-wrapper stroke for--boxes">
            <div class="glow-item left"></div>
            <div class="glow-item"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="section-169"></section>
  <div class="w-embed w-script"><!--  ============================
  Fiduciary Snapshot — v3.7.1 (functional fixes only) — MEMO REMOVED
  Rent vs Buy math aligned with FD module (closing, selling, equity, opp-cost)
============================  -->
    <div id="fid-snapshot" data-summarize="https://theorozcorealty.netlify.app/.netlify/functions/summarize" style="all: initial;">
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
      <style>
    #fid-snapshot, #fid-snapshot *{ box-sizing:border-box; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
    #fid-snapshot .wrap{ width:100%; max-width:min(100vw - 48px, 1700px); margin:18px auto 56px; padding:0 16px; color:#e9ecff; }
    :root{ --bg:#0f1220; --panel:#15192b; --card:#181b2e; --ink:#e9ecff; --muted:#a8b0d6; --accent:#6aa7ff; --accent2:#8ef3c5; --ok:#55d399; --warn:#f9c74f; --bad:#ff6b6b; }
    #fid-snapshot .card{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:0 10px 24px rgba(0,0,0,.35); padding:18px; position:relative; }
    #fid-snapshot .row{ display:grid; grid-template-columns:1fr auto auto; gap:16px; align-items:center; }
    @media (max-width:840px){ #fid-snapshot .row{ grid-template-columns:1fr; } }
    #fid-snapshot .badge{ display:inline-flex; align-items:center; gap:10px; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,.08); background:#0f1326; white-space:nowrap; }
    #fid-snapshot .dot{ width:12px; height:12px; border-radius:50%; }
    #fid-snapshot .export{ padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.14); background:#0f1326; color:#e9ecff; cursor:pointer; }
    #fid-snapshot .export:hover{ filter:brightness(1.15); }
    /* KPI strip (5 boxes) */
    #fid-snapshot .kpi-strip{ display:grid; grid-template-columns:repeat(5,minmax(0,1fr)); gap:18px; margin-top:18px; }
    @media (max-width:1280px){ #fid-snapshot .kpi-strip{ grid-template-columns:repeat(3,minmax(0,1fr)); } }
    @media (max-width:760px){ #fid-snapshot .kpi-strip{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media (max-width:520px){ #fid-snapshot .kpi-strip{ grid-template-columns:1fr; } }
    #fid-snapshot .kpi-card{ background:#12162b; border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:14px; min-height:76px; }
    #fid-snapshot .kpi-title{ font-size:12px; color:var(--muted); letter-spacing:.2px; }
    #fid-snapshot .kpi-val{ margin-top:8px; font-weight:700; font-size:20px; display:flex; align-items:center; gap:8px; }
    #fid-snapshot .delta{ font-size:11px; margin-left:8px; padding:2px 6px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background:rgba(85,211,153,.10); color:var(--ok); }
    /* Mini meter inside Grade/Disposable badge */
    #fid-snapshot .badge .mini-wrap{ display:flex; align-items:center; gap:10px; }
    #fid-snapshot .mini-meter{ width:160px; height:8px; border-radius:999px; background:#0b0f23; border:1px solid rgba(255,255,255,.12); overflow:hidden; }
    #fid-snapshot .mini-meter > div{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent2),#f9c74f,#ff6b6b); }
    /* Credit score gauge */
    #fid-snapshot .score-bar{ position:relative; width:100%; height:10px; border-radius:999px; background:linear-gradient(90deg,#ff6b6b,#f9c74f,#55d399); margin-top:8px; }
    #fid-snapshot .score-marker{ position:absolute; top:-3px; width:2px; height:16px; background:#e9ecff; border-radius:2px; left:0%; box-shadow:0 0 6px rgba(255,255,255,.6); }
    /* Middle visuals */
    #fid-snapshot .mid{ display:grid; grid-template-columns:480px 1fr; gap:18px; margin-top:18px; }
    @media (max-width:1080px){ #fid-snapshot .mid{ grid-template-columns:1fr; } }
    #fid-snapshot .card-mini{ background:#12162b; border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; display:flex; flex-direction:column; }
    #fid-snapshot .card-mini h3{ margin:0 0 12px; font-size:14px; color:#cfd5ff; font-weight:700; letter-spacing:.3px; }
    #fid-snapshot .chart-holder{ position:relative; height: clamp(220px, 36vh, 420px); width: 100%; display:block; overflow:hidden; border-radius:12px; }
    #fid-snapshot canvas{ width:100% !important; height:100% !important; display:block; }
    #fid-snapshot .ring-center{ position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; font-weight:800; font-size:28px; color:#e9ecff; text-shadow:0 0 18px rgba(0,0,0,.5); }
    #fid-snapshot .legend{ display:flex; gap:16px; margin-top:10px; flex-wrap:wrap; color:#a8b0d6; font-size:12px; }
    #fid-snapshot .l-pill{ display:inline-flex; align-items:center; gap:8px; }
    #fid-snapshot .l-dot{ width:10px; height:10px; border-radius:999px; background:#6aa7ff; }
    /* Expenses controls */
    #fid-snapshot .controls{ display:flex; gap:10px; align-items:center; margin:4px 0 10px; flex-wrap:wrap; }
    #fid-snapshot .select{ background:#0f1326; color:#e9ecff; border:1px solid rgba(255,255,255,.10); border-radius:10px; padding:8px 10px; }
    #fid-snapshot .toggle{ cursor:pointer; padding:6px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.10); background:#0f1326; font-size:12px; }
    #fid-snapshot .toggle[aria-pressed="true"]{ background:#192041; border-color:rgba(255,255,255,.22); }
    /* Bottom line */
    #fid-snapshot .bottom{ background:#12162b; border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; margin-top:18px; }
    #fid-snapshot .row-slim{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px; }
    #fid-snapshot .h4{ font-weight:800; letter-spacing:.2px; }
    /* Rent control (select) */
    #fid-snapshot .rent-ctrl{ display:flex; align-items:center; gap:10px; }
    #fid-snapshot .rent-label{ font-size:11px; color:var(--muted); }
    #fid-snapshot .rent-select{
      appearance:none; background:#0f1326; color:#e9ecff; border:1px solid rgba(255,255,255,.12);
      border-radius:10px; padding:8px 10px; min-width:140px; cursor:pointer;
    }
    @media print{ body, html{ background:#fff !important; } }
  </style>
      <div class="wrap">
        <div class="card" id="fid-card">
          <div class="row">
            <span class="badge" id="grade-chip">
              <span id="fid-dot" class="dot" style="background:#888"></span>
              <div class="mini-wrap">
                <div>
                  <b id="fid-grade">Loading...</b>
                  <span id="fid-disp" style="margin-left:8px; opacity:.85">$0</span>
                </div>
                <div class="mini-meter" aria-label="grade-meter">
                  <div id="fid-meter"></div>
                </div>
              </div>
            </span>
            <button id="fid-export" class="export">Export ▾</button>
          </div>
          <div class="kpi-strip">
            <div class="kpi-card">
              <div class="kpi-title">Total Monthly Income</div>
              <div class="kpi-val" id="k-income">$0 <span class="delta" id="k-inc-delta">+0%</span></div>
            </div>
            <div class="kpi-card">
              <div class="kpi-title">Total Monthly Expense</div>
              <div class="kpi-val" id="k-expense">$0 <span class="delta" id="k-exp-delta" style="background:rgba(255,107,107,.12); color:var(--bad);">+0%</span></div>
            </div>
            <div class="kpi-card">
              <div class="kpi-title">Mortgage Estimate</div>
              <div class="kpi-val" id="k-mtg">$0</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-title">Total Savings</div>
              <div class="kpi-val" id="k-save">$0 <span class="delta" id="k-sav-delta">+1.3%</span></div>
            </div>
            <div class="kpi-card">
              <div class="kpi-title">Credit Score <span id="score-band" style="margin-left:6px; font-weight:700;"></span></div>
              <div class="kpi-val"><span id="k-score">—</span></div>
              <div class="score-bar">
                <div id="score-marker" class="score-marker"></div>
              </div>
            </div>
          </div>
          <div class="mid">
            <div class="card-mini">
              <h3>OVERALL BUDGET</h3>
              <div class="chart-holder" style="height: clamp(280px, 42vh, 460px);">
                <canvas id="fid-pie"></canvas>
                <div class="ring-center" id="pie-center">0</div>
              </div>
              <div class="legend">
                <span class="l-pill"><span class="l-dot" style="background:#6aa7ff"></span>Expenses</span>
                <span class="l-pill"><span class="l-dot" style="background:#55d399"></span>Mortgage</span>
                <span class="l-pill"><span class="l-dot" style="background:#8ef3c5"></span>Savings</span>
                <span class="l-pill"><span class="l-dot" style="background:#f9c74f"></span>Disposable</span>
              </div>
            </div>
            <div class="card-mini">
              <h3>MONTHLY EXPENSES INTELLIGENCE</h3>
              <div class="controls">
                <button id="mode-abs" class="toggle" aria-pressed="true">$ Totals</button>
                <button id="mode-pct" class="toggle" aria-pressed="false">% Composition</button>
                <select id="exp-view" class="select">
                  <option value="monthly" selected="">Monthly</option>
                  <option value="yearly">Yearly</option>
                </select>
              </div>
              <div class="chart-holder"><canvas id="fid-bars"></canvas></div>
              <div class="muted" style="margin-top:8px">Monthly view shows categories; Yearly view shows months. Toggle $ / % to switch measure.</div>
            </div>
          </div>
          <div class="bottom">
            <div class="row-slim" style="gap:12px; flex-wrap:wrap;">
              <div class="h4">RENT vs BUY — NET COST</div>
              <!--  Rent select for 10-year comparison  -->
              <div class="rent-ctrl" style="margin-left:auto;">
                <div class="badge" title="Starting monthly rent used for the 10-year comparison" style="gap:8px;">
                  <span class="rent-label">Rent Price (mo)</span>
                  <select id="rent-select" class="rent-select"></select>
                </div>
                <span class="badge" title="Years until Net Cost of Buying ≤ Renting" style="margin-left:6px;">
                  <div style="display:flex; flex-direction:column; line-height:1.1;">
                    <span style="font-size:11px; color:var(--muted)">Break-even (Years)</span>
                    <b id="be-yrs" style="font-size:16px;">—</b>
                  </div>
                </span>
              </div>
            </div>
            <div class="chart-holder" style="height: clamp(240px, 36vh, 400px);">
              <canvas id="fid-line"></canvas>
            </div>
          </div>
          <div class="muted" style="margin-top:10px">Outputs are educational, not advice.</div>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
      <script>
  (()=> {
    if (window.__FIDUCIARY_WIDGET_MOUNTED__) return;
    window.__FIDUCIARY_WIDGET_MOUNTED__ = true;
    /* ---------- Utils ---------- */
    const $=(q)=>document.querySelector(q);
    const cur=(n,d=0)=> (Number(n)||0).toLocaleString('en-US',{style:'currency',currency:'USD',minimumFractionDigits:d,maximumFractionDigits:d});
    const signed=(n)=> (n>=0? cur(n,0) : ('-'+cur(Math.abs(n),0)));
    function pmti(P,r,n){ if(r===0) return P/n; const x=Math.pow(1+r,n); return P*(r*x)/(x-1); }
    function scoreAPR(s){ s=Number(s)||720;
      if(s>=780) return 6.50; if(s>=760) return 6.75; if(s>=720) return 7.00; if(s>=700) return 7.20;
      if(s>=680) return 7.35; if(s>=660) return 7.85; if(s>=640) return 8.25; if(s>=620) return 9.25; return 9.95;
    }
    function bandFromScore(s){
      if(s>=760) return 'Excellent';
      if(s>=720) return 'Good';
      if(s>=680) return 'Fair';
      if(s>=640) return 'OK-ish';
      if(s>=620) return 'Weak';
      return 'Subprime';
    }
    const months = ['Oct','Nov','Dec','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep'];
    let pieChart=null, barChart=null, lineChart=null;
    let barMode='abs';
    let barView='monthly';
    let rentStartOverride = null; // monthly rent at Year 0
    /* ---------- Bridge ---------- */
    let bridge = null;
    try { const raw = localStorage.getItem('realtysass.bridge'); if (raw) bridge = JSON.parse(raw); } catch(e){}
    if (!bridge && location.hash){
      const m = location.hash.match(/(?:^|#|&)rsb=([A-Za-z0-9\-_]+)/);
      if (m){ try{ const json = decodeURIComponent(escape(atob(m[1].replace(/-/g,'+').replace(/_/g,'/')))); bridge = JSON.parse(json);}catch(e){} }
    }
    try{
      if(!bridge?.itemizedRows){
        const rows = JSON.parse(localStorage.getItem('va.expenses.rows')||'[]');
        if(rows?.length){
          bridge = Object.assign({}, bridge, {
            itemizedRows: rows.map(r=>({ name:r.name, monthly:r.month, cat:r.cat }))
          });
        }
      }
    }catch(_){}
    window.addEventListener('message', (ev)=>{
      try{ const msg = ev.data || {}; if (msg.type==='realtysass-bridge' && msg.payload){ bridge=msg.payload; rentStartOverride=null; paintAll(); } }catch(e){}
    }, false);
    /* ---------- Snapshot ---------- */
    function snapshotFromBridge(){
      const b = bridge || {};
      const income   = Number(b.income)||0;
      const expenses = Number(b.expenses)||0;
      const savings  = Number(b.savings)||0;
      let housing = Number(b.housing)||0;
      let pAndI = Number(b.pAndI)||0;
      const price = Number(b.price)||0;
      const dpPct = Number(b.dpPct)||0;
      const dpAmt = Number(b.dpAmt) || (price * (dpPct/100));
      const apr   = Number(b.apr)|| scoreAPR(Number(b.creditScore)||720);
      const termY = Number(b.termYears)||30;
      const tihoa = Number(b.tihoa)||0;
      const pmi   = Number(b.pmi)||0;
      if (!housing){
        const loan  = Math.max(0, price - dpAmt);
        const mRate = (apr/100)/12;
        const termN = Math.max(1, termY*12);
        pAndI = loan>0 ? pmti(loan, mRate, termN) : 0;
        housing = pAndI + tihoa + pmi;
      }
      const freePost = income - expenses - savings - housing;
      return {
        income, expenses, savings, housing, freePost,
        price, dpPct, dpAmt, apr, creditScore:Number(b.creditScore)||720, termYears:termY,
        tihoa, pmi, pAndI
      };
    }
    /* ---------- Expense bucketing (unchanged) ---------- */
    const bucketDefs = {
      Housing: /(rent|mortgage|pmi|hoa|home ?insur|property tax|tihoa|home repair|furniture)/i,
      Utilities: /(util|electric|power|water|gas|sewer|trash|phone|internet|wifi)/i,
      Transportation: /(car|auto|fuel|gasoline|uber|lyft|transport|parking|toll|insurance.*auto|maintenance)/i,
      Food: /(grocery|grocer|food|meal|dining|restaurant|lunch|breakfast|coffee)/i,
      Health: /(health|medical|dental|vision|pharmacy|rx|gym)/i,
      Entertainment: /(netflix|hulu|prime|disney|movie|game|sport|concert|entertain)/i
    };
    const bucketOrder = ['Housing','Utilities','Transportation','Food','Health','Entertainment','Other'];
    function monthlyBucketsFromBridge(){
      const rows = Array.isArray(bridge?.itemizedRows) ? bridge.itemizedRows : [];
      const now = new Date();
      const yearMonths = [];
      for(let i=0;i<12;i++){
        const d=new Date(now.getFullYear(), now.getMonth()- (11-i), 1);
        yearMonths.push({key:`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`, label: months[i]});
      }
      const init = {}; yearMonths.forEach(m=>{ init[m.key] = Object.fromEntries(bucketOrder.map(b=>[b,0])); });
      if (rows.length){
        rows.forEach(r=>{
          const name = String(r.name||r.item||'').toLowerCase();
          const amt  = Number(r.amount||r.monthly||r.value||0)||0;
          yearMonths.forEach(mk=> distributeToBucket(init[mk.key], name, amt/12));
        });
      } else {
        const ex = Number(bridge?.expenses)||0;
        const alloc = {Housing:.35, Utilities:.12, Transportation:.14, Food:.20, Health:.07, Entertainment:.07, Other:.05};
        yearMonths.forEach(m=>{
          for(const k of bucketOrder){ init[m.key][k] += ex * (alloc[k]||0) / 12; }
        });
      }
      const labels = yearMonths.map(m=>m.label);
      const series = {};
      bucketOrder.forEach(b=> series[b] = yearMonths.map(m=> init[m.key][b]||0));
      return { labels, series, raw:init, keys:yearMonths.map(m=>m.key) };
    }
    function distributeToBucket(monthObj, nameLower, amt){
      let bucket = 'Other';
      for (const [b,rx] of Object.entries(bucketDefs)){ if (rx.test(nameLower)) { bucket = b; break; } }
      monthObj[bucket] = (monthObj[bucket]||0) + Math.max(0, amt);
    }
    /* ---------- Grade (unchanged visual) ---------- */
    function localGrade(s){
      const totalShare = (s.expenses + s.savings + s.housing) / (s.income||1);
      const housingShare = s.housing / (s.income||1);
      let g=92;
      if(totalShare>=0.85) g-=30; else if(totalShare>=0.70) g-=15; else g+=4;
      if(housingShare>0.40) g-=18; else if(housingShare>0.33) g-=8; else g+=4;
      if(s.freePost<0) g-=30; else if((s.freePost/s.income)<0.10) g-=10; else if((s.freePost/s.income)>=0.20) g+=4;
      const sr=s.savings/(s.income||1); if(sr<0.10) g-=8; else if(sr>=0.20) g+=4;
      g=Math.max(0,Math.min(100,g));
      const letter = g>=98?'A+': g>=92?'A': g>=88?'A-'
                   : g>=82?'B+': g>=76?'B': g>=72?'B-'
                   : g>=66?'C+': g>=60?'C': g>=55?'C-'
                   : g>=50?'D+': g>=45?'D':'F';
      return {letter, totalShare};
    }
    /* ---------- Charts ---------- */
    function initCharts(){
      const pieCtx = document.getElementById('fid-pie').getContext('2d');
      pieChart = new Chart(pieCtx,{ type:'doughnut',
        data:{ labels:['Expenses','Mortgage','Savings','Disposable'],
          datasets:[{ data:[0,0,0,1], backgroundColor:['#6aa7ff','#55d399','#8ef3c5','#f9c74f'], borderWidth:0 }] },
        options:{ cutout:'66%', plugins:{ legend:{ display:false } }, responsive:true, maintainAspectRatio:false }
      });
      const barCtx = document.getElementById('fid-bars').getContext('2d');
      barChart = new Chart(barCtx,{ type:'bar',
        data:{ labels: [], datasets: [] },
        options:{
          plugins:{ legend:{ labels:{ color:'#cfd5ff', boxWidth:12 }, display:true } },
          scales:{
            x:{ stacked:true, ticks:{ color:'#cfd5ff' }, grid:{ color:'rgba(255,255,255,.06)' } },
            y:{ stacked:true, ticks:{ color:'#cfd5ff' }, grid:{ color:'rgba(255,255,255,.06)' } }
          },
          responsive:true, maintainAspectRatio:false,
          datasets:{ bar:{ borderWidth:0, borderRadius:6 } }
        }
      });
      const lineCtx = document.getElementById('fid-line').getContext('2d');
      lineChart = new Chart(lineCtx,{ type:'line',
        data:{ labels:[], datasets:[
          { label:'Buy – Net Cost', data:[], tension:.35, fill:false, borderWidth:2, pointRadius:0, borderColor:'#6aa7ff' },
          { label:'Rent – Net Cost', data:[], tension:.35, fill:false, borderWidth:2, pointRadius:0, borderColor:'#55d399' }
        ]},
        options:{ plugins:{ legend:{ display:true, labels:{ color:'#cfd5ff' } },
          tooltip:{ callbacks:{ label:(c)=>{
            const lbl = `${c.dataset.label}: ${cur(c.raw,0)}`;
            if (c.datasetIndex===0 && lineChart.__equityByYear){
              const eq = lineChart.__equityByYear[c.dataIndex]||0;
              return [lbl, `Equity: ${cur(eq,0)}`];
            }
            if (c.datasetIndex===1 && lineChart.__cumRentByYear){
              const cr = lineChart.__cumRentByYear[c.dataIndex]||0;
              return [lbl, `Cumulative Rent: ${cur(cr,0)}`];
            }
            return lbl;
          }}}},
          scales:{ x:{ ticks:{ color:'#cfd5ff' }, grid:{ display:false } },
                   y:{ ticks:{ color:'#cfd5ff' }, grid:{ color:'rgba(255,255,255,.06)' } } },
          responsive:true, maintainAspectRatio:false }
      });
      const ro = new ResizeObserver(()=>{ pieChart?.resize(); barChart?.resize(); lineChart?.resize(); });
      document.querySelectorAll('#fid-snapshot .chart-holder').forEach(h=> ro.observe(h));
    }
    function updateExpenseBars(){
      const {labels, series, raw, keys} = monthlyBucketsFromBridge();
      const lastKey = keys[keys.length-1];
      const latest = raw[lastKey] || {};
      barChart.data.labels = bucketOrder;
      barChart.data.datasets = [{
        label:'This Month',
        data: bucketOrder.map(b=> latest[b]||0),
        backgroundColor: ['#6aa7ff','#8ab6ff','#55d399','#8ef3c5','#f9c74f','#b58cff','#6e7a94'],
        stack:'m'
      }];
      barChart.update();
    }
    /* ---------- Rent vs Buy (10-year, FD math) ---------- */
    const CLOSE_PCT = 0.03;  // 3%
    const SELL_PCT  = 0.07;  // 7%
    const APP_Y     = 0.03;  // 3%/yr appreciation
    const INVRET_Y  = 0.05;  // 5%/yr opportunity cost
    const MAINT_Y   = 0.01;  // 1%/yr maintenance (tax/ins/HOA already in s.tihoa)
    function buildRentVsBuySeries10Y_FD(s, rentStartMonthly){
      const Y = 10, N = Y*12;
      const labels = Array.from({length:Y+1}, (_,i)=> `Year ${i}`);
      const price = Math.max(150000, Number(s.price)||350000);
      const down  = Math.max(0, Number(s.dpAmt)||0);
      const loan0 = Math.max(0, price - down);
      const r_m   = (Number(s.apr)||7)/100/12;
      const nTot  = (Number(s.termYears)||30)*12;
      const piMo  = loan0>0 ? pmti(loan0, r_m, nTot) : 0;
      const tihoa = Number(s.tihoa)||0;
      const pmi   = Number(s.pmi)||0;
      const maintMo = (price*MAINT_Y)/12;
      const closing = price*CLOSE_PCT;
      const upfront = down + closing;
      const rent0     = Math.max(0, Number(rentStartMonthly));
      const rent_g_m  = Math.pow(1+0.03, 1/12)-1; // 3%/yr
      const appr_m    = Math.pow(1+APP_Y, 1/12)-1;
      const inv_m     = Math.pow(1+INVRET_Y, 1/12)-1;
      let bal = loan0, homeVal = price;
      let cumRent = 0, cumOwner = upfront;
      const rentSeries=[0], buySeries=[upfront], equityByYear=[down], cumRentByYear=[0];
      let altInvest = down;
      let beMonth = null; // monthly precision
      for(let m=1; m<=N; m++){
        // Rent
        const rent_m = rent0 * Math.pow(1+rent_g_m, m-1);
        cumRent += rent_m;
        altInvest *= (1 + inv_m);
        // Buy
        const interest = bal * r_m;
        const principal = Math.max(0, piMo - interest);
        bal = Math.max(0, bal - principal);
        cumOwner += (piMo + tihoa + pmi + maintMo);
        // Assets
        homeVal *= (1 + appr_m);
        const equity = Math.max(0, homeVal - bal);
        // Net streams at month m (for accurate break-even)
        const sellCost_m = homeVal * SELL_PCT;
        const netIfSold_m = Math.max(homeVal - sellCost_m - bal, 0);
        const buyNet_m = Math.max(0, cumOwner - netIfSold_m);
        const rentNet_m = Math.max(0, cumRent - (altInvest - down));
        if (beMonth===null && buyNet_m <= rentNet_m){ beMonth = m; }
        if (m % 12 === 0){
          buySeries.push(buyNet_m);
          rentSeries.push(rentNet_m);
          equityByYear.push(equity);
          cumRentByYear.push(cumRent);
        }
      }
      const beYears = beMonth!==null ? (beMonth/12) : null; // fractional years
      return { labels, rentSeries, buySeries, equityByYear, cumRentByYear, beYears };
    }
    function currentRentStartFromBridge(s){
      // Default = 1% rule monthly
      const base = Math.max(0, (Number(s.price)||350000) * 0.01);
      return rentStartOverride==null ? base : Math.max(0, rentStartOverride);
    }
    function populateRentSelect(base){
      const sel = document.getElementById('rent-select');
      const vals = [];
      for(let d=-6; d<=6; d++){
        const v = Math.max(0, Math.round((base + d*500)));
        if(!vals.includes(v)) vals.push(v);
      }
      sel.innerHTML = vals.map(v=> `<option value="${v}">${cur(v,0)}</option>`).join('');
      const target = Math.max(0, Math.round(currentRentStartFromBridge(snapshotFromBridge())));
      if (!vals.includes(target)){
        sel.insertAdjacentHTML('afterbegin', `<option value="${target}">${cur(target,0)}</option>`);
      }
      sel.value = String(target);
    }
    /* ---------- Paint ---------- */
    function paintAll(){
      const s = snapshotFromBridge();
      // KPIs
      $('#k-income').firstChild.nodeValue = cur(s.income,0)+' ';
      $('#k-expense').firstChild.nodeValue= cur(s.expenses,0)+' ';
      $('#k-mtg').textContent            = cur(s.housing,0);
      $('#k-save').firstChild.nodeValue  = cur(s.savings,0)+' ';
      // Credit score KPI + gauge
      const cs = Number(s.creditScore)||720;
      $('#k-score').textContent = cs;
      $('#score-band').textContent = `(${bandFromScore(cs)})`;
      const pct = Math.max(0, Math.min(1, (cs - 300) / (850 - 300)));
      $('#score-marker').style.left = (pct*100)+'%';
      // Grade chip + inline meter
      $('#fid-disp').textContent = signed(s.income - s.expenses - s.savings - s.housing);
      const {letter, totalShare} = localGrade({ ...s, totalShare:(s.expenses+s.savings+s.housing)/(s.income||1) });
      $('#fid-grade').textContent = letter+' / Disposable';
      $('#fid-dot').style.background = (letter[0]==='A'||letter[0]==='B')?'var(--ok)':(letter[0]==='C'?'var(--warn)':'var(--bad)');
      $('#fid-meter').style.width = Math.max(0, Math.min(1, totalShare))*100 + '%';
      // Charts init
      if(!pieChart || !barChart || !lineChart) initCharts();
      $('#pie-center').textContent = s.income>0 ? s.income.toLocaleString() : '0';
      pieChart.data.datasets[0].data = [s.expenses, s.housing, s.savings, Math.max(0, s.income - s.expenses - s.savings - s.housing)];
      pieChart.update();
      updateExpenseBars();
      // Rent select (around 1% rule)
      const baseRent = Math.max(0, (Number(s.price)||350000) * 0.01);
      populateRentSelect(baseRent);
      // Rent vs Buy (10Y constant, FD math)
      const rentStart = currentRentStartFromBridge(s);
      const rvb = buildRentVsBuySeries10Y_FD(s, rentStart);
      lineChart.data.labels = rvb.labels;
      lineChart.data.datasets[0].data = rvb.buySeries;
      lineChart.data.datasets[1].data = rvb.rentSeries;
      lineChart.__equityByYear   = rvb.equityByYear;
      lineChart.__cumRentByYear  = rvb.cumRentByYear;
      lineChart.update();
      // Break-even (years with tenth)
      const be = rvb.beYears;
      $('#be-yrs').textContent = (be==null) ? '—' : ((Math.round(be*10)/10).toFixed(1)+' yrs').replace('.0 yrs',' yrs');
    }
    /* ---------- Controls & Export ---------- */
    // Rent select change (scroll/dropdown)
    document.addEventListener('change', (e)=>{
      if (e.target && e.target.id==='rent-select'){
        rentStartOverride = Number(e.target.value)||0;
        paintAll();
      }
    });
    document.getElementById('mode-abs').addEventListener('click', ()=>{
      barMode='abs';
      document.getElementById('mode-abs').setAttribute('aria-pressed','true');
      document.getElementById('mode-pct').setAttribute('aria-pressed','false');
      updateExpenseBars();
    });
    document.getElementById('mode-pct').addEventListener('click', ()=>{
      barMode='pct';
      document.getElementById('mode-pct').setAttribute('aria-pressed','true');
      document.getElementById('mode-abs').setAttribute('aria-pressed','false');
      updateExpenseBars();
    });
    $('#exp-view').addEventListener('change', (e)=>{
      barView = e.target.value === 'monthly' ? 'monthly' : 'yearly';
      updateExpenseBars();
    });
    $('#fid-export').addEventListener('click', async ()=>{
      const el = document.getElementById('fid-card');
      const rect = el.getBoundingClientRect();
      const scale = Math.max(2, window.devicePixelRatio || 2);
      const cloned = el.cloneNode(true);
      const serializer = new XMLSerializer();
      const markup = serializer.serializeToString(cloned);
      const svg = '<svg xmlns="http://www.w3.org/2000/svg" width="'+(rect.width*scale)+'" height="'+(rect.height*scale)+'">' +
                    '<foreignObject x="0" y="0" width="100%" height="100%">' +
                      markup +
                    '</foreignObject>' +
                  '</svg>';
      const blob = new Blob([svg], {type: 'image/svg+xml;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const img = new Image();
      img.onload = ()=>{
        const canvas = document.createElement('canvas');
        canvas.width = rect.width*scale; canvas.height = rect.height*scale;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#0f1220'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        URL.revokeObjectURL(url);
        const a = document.createElement('a');
        a.download = 'Fiduciary-Snapshot.png';
        a.href = canvas.toDataURL('image/png');
        a.click();
      };
      img.src = url;
    });
    (function boot(){ initCharts(); paintAll(); })();
  })();
  </script>
    </div>
  </div>
  <section></section>
  <section>
    <div class="w-embed w-script">Fiduciary Memo — Standalone v1.3 (Executive CEO/Harvard-grade)
      Improvements:
      • ALWAYS 5 paragraphs (client + server synthesis if model returns <5) 2="" •="" rank="" +="" last="" name="" greeting="" with="" robust="" identity="" sourcing="" paragraph="" 4:="" concrete="" dollar="" targets,="" tactics,="" and="" links="===========================--">
        <div id="fid-memo" data-summarize="https://theorozcorealty.netlify.app/.netlify/functions/summarize" style="all: initial;">
          <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
          <style>
    #fid-memo, #fid-memo *{ box-sizing:border-box; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    :root{ --ink:#1b1f2b; --muted:#4b5568; --brand:#0f1220; --border:rgba(0,0,0,.10); }
    /* Card */
    #fid-memo .memo-card{
      background:#ffffff; color:var(--ink);
      border:1px solid var(--border); border-radius:14px;
      padding:0; margin:18px auto; width:100%; max-width:900px;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
    }
    #fid-memo .memo-page{ padding:28px 28px 22px; }
    #fid-memo .memo-head{ text-align:center; margin-bottom:8px; }
    #fid-memo .memo-head img{ height:64px; width:auto; display:block; margin:6px auto 10px auto; }
    #fid-memo .memo-title{ font-weight:900; letter-spacing:.2px; font-size:18px; text-transform:uppercase; }
    #fid-memo .memo-sub{ color:var(--muted); font-size:12px; }
    #fid-memo .memo-hr{ border:none; border-top:1px solid var(--border); margin:12px 0 14px; }
    #fid-memo .memo-body p{ margin:10px 0; line-height:1.65; font-size:14px; }
    #fid-memo .memo-body strong{ font-weight:800; }
    #fid-memo .memo-meta{ display:flex; justify-content:space-between; gap:8px; color:var(--muted); font-size:12px; margin-bottom:2px; }
    #fid-memo .memo-sign{ margin-top:14px; border-top:1px dashed rgba(0,0,0,.18); padding-top:10px; font-size:13px; }
    /* Status note */
    #fid-memo .ai-note{ margin:10px 28px 18px; font-size:11px; }
    #fid-memo .ai-note.loading{ color:#334155; }
    #fid-memo .ai-note.success{ color:#177245; }
    #fid-memo .ai-note.error{ color:#b42318; }
    /* Toolbar */
    #fid-memo .toolbar{
      max-width:900px; margin:0 auto 10px; display:flex; gap:8px; justify-content:flex-end;
      font-size:13px;
    }
    #fid-memo .btn{
      padding:8px 12px; border-radius:10px; border:1px solid rgba(0,0,0,.12); background:#f8fafc; color:#0f172a; cursor:pointer;
    }
    #fid-memo .btn:hover{ filter:brightness(0.98); }
    @media print{
      #fid-memo .memo-card{ box-shadow:none; border-color:#bbb; }
      body, html{ background:#fff !important; }
      #fid-memo .toolbar{ display:none; }
    }
  </style>
          <div class="toolbar">
            <button id="memo-refresh" class="btn">Regenerate Memo</button>
            <button id="memo-print" class="btn">Print / Save PDF</button>
          </div>
          <div class="memo-card" id="memo">
            <div class="memo-page">
              <div class="memo-head">
                <img src="../images/Call-to-Action.png" alt="Orozco Crest">
                <div class="memo-title">FIDUCIARY MEMO</div>
                <div class="memo-sub">Board-Ready Summary</div>
              </div>
              <div class="memo-meta">
                <span id="memo-date"></span>
                <span id="memo-client">Client:</span>
                <span>Prepared by: The Orozco Realty</span>
              </div>
              <hr class="memo-hr">
              <div id="memo-body" class="memo-body">
                <p><em>Generating executive memo…</em></p>
              </div>
              <div class="memo-sign">— <strong>Elena</strong>, Your Virtual Concierge<br><span style="opacity:.85">The Orozco Realty</span></div>
            </div>
            <div id="memo-note" class="ai-note loading">Preparing AI memo…</div>
          </div>
          <script>
  (()=> {
    if (window.__FIDUCIARY_MEMO_MOUNTED__) return;
    window.__FIDUCIARY_MEMO_MOUNTED__ = true;
    /* ---------- small utils ---------- */
    const $=(q)=>document.querySelector(q);
    const cur=(n,d=0)=> (Number(n)||0).toLocaleString('en-US',{style:'currency',currency:'USD',minimumFractionDigits:d,maximumFractionDigits:d});
    function pmti(P,r,n){ if(r===0) return P/n; const x=Math.pow(1+r,n); return P*(r*x)/(x-1); }
    function scoreAPR(s){ s=Number(s)||720;
      if(s>=780) return 6.50; if(s>=760) return 6.75; if(s>=720) return 7.00; if(s>=700) return 7.20;
      if(s>=680) return 7.35; if(s>=660) return 7.85; if(s>=640) return 8.25; if(s>=620) return 9.25; return 9.95;
    }
    function gradeLocal(s){
      let g=92;
      if(s.totalShare>=0.85) g-=30; else if(s.totalShare>=0.70) g-=15; else g+=4;
      if(s.housingShare>0.40) g-=18; else if(s.housingShare>0.33) g-=8; else g+=4;
      if(s.freePost<0) g-=30; else if((s.freePost/s.income)<0.10) g-=10; else if((s.freePost/s.income)>=0.20) g+=4;
      const sr=s.savings/(s.income||1); if(sr<0.10) g-=8; else if(sr>=0.20) g+=4;
      g=Math.max(0,Math.min(100,g));
      const letter = g>=98?'A+': g>=92?'A': g>=88?'A-'
                   : g>=82?'B+': g>=76?'B': g>=72?'B-'
                   : g>=66?'C+': g>=60?'C': g>=55?'C-'
                   : g>=50?'D+': g>=45?'D':'F';
      return {g,letter};
    }
    const lastNameOf=(full)=> String(full||'').trim().split(/\s+/).slice(-1)[0]||'Client';
    /* ---------- identity helpers ---------- */
    function getStoredJSON(key){
      try{ const raw = localStorage.getItem(key); return raw? JSON.parse(raw): null; }catch(_){ return null; }
    }
    function extractIdentity(b){
      const profFromBridge = b?.profile || {};
      const profFromLocal  = getStoredJSON('realtysass.profile') || {};
      const milFromBridge  = b?.military || {};
      const milFromLocal   = getStoredJSON('realtysass.military') || {};
      const name   = profFromLocal.name || profFromBridge.name || b?.userName || 'Client';
      const email  = profFromLocal.email|| profFromBridge.email|| b?.userEmail || '';
      const branch = milFromLocal.branch || profFromLocal.branch || milFromBridge.branch || profFromBridge.branch || '';
      const rank   = milFromLocal.rank   || profFromLocal.rank   || milFromBridge.rank   || profFromBridge.rank   || b?.rank || '';
      return { name, email, branch, rank };
    }
    /* ---------- paygrade → rank ---------- */
    function rankFriendly(paygrade, branch){
      const p = String(paygrade||'').toUpperCase().replace(/\s+/g,'');
      const b = String(branch||'').toLowerCase();
      const OFF = {"O-1":"Second Lieutenant (O-1)","O-2":"First Lieutenant (O-2)","O-3":"Captain (O-3)","O-4":"Major (O-4)","O-5":"Lieutenant Colonel (O-5)","O-6":"Colonel (O-6)","O-7":"Brigadier General (O-7)","O-8":"Major General (O-8)","O-9":"Lieutenant General (O-9)","O-10":"General (O-10)"};
      const WARR={"W-1":"Warrant Officer 1 (W-1)","W-2":"Chief Warrant Officer 2 (W-2)","W-3":"Chief Warrant Officer 3 (W-3)","W-4":"Chief Warrant Officer 4 (W-4)","W-5":"Chief Warrant Officer 5 (W-5)"};
      const AF  ={"E-1":"Airman Basic (E-1)","E-2":"Airman (E-2)","E-3":"Airman First Class (E-3)","E-4":"Senior Airman (E-4)","E-5":"Staff Sergeant (E-5)","E-6":"Technical Sergeant (E-6)","E-7":"Master Sergeant (E-7)","E-8":"Senior Master Sergeant (E-8)","E-9":"Chief Master Sergeant (E-9)"};
      const ARMY={"E-1":"Private (E-1)","E-2":"Private (E-2)","E-3":"Private First Class (E-3)","E-4":"Specialist/Corporal (E-4)","E-5":"Sergeant (E-5)","E-6":"Staff Sergeant (E-6)","E-7":"Sergeant First Class (E-7)","E-8":"Master/First Sergeant (E-8)","E-9":"Sergeant Major (E-9)"};
      const NAVYMC={"E-1":"Seaman Recruit/Private (E-1)","E-2":"Seaman Apprentice/Private (E-2)","E-3":"Seaman/Private First Class (E-3)","E-4":"Petty Officer Third Class/Corporal (E-4)","E-5":"Petty Officer Second Class/Sergeant (E-5)","E-6":"Petty Officer First Class/Staff Sergeant (E-6)","E-7":"Chief Petty Officer/Gunnery Sergeant (E-7)","E-8":"Senior Chief/First Sergeant (E-8)","E-9":"Master Chief/Master Gunnery Sergeant (E-9)"};
      const CG  ={"E-1":"Seaman Recruit (E-1)","E-2":"Seaman Apprentice (E-2)","E-3":"Seaman (E-3)","E-4":"Petty Officer Third Class (E-4)","E-5":"Petty Officer Second Class (E-5)","E-6":"Petty Officer First Class (E-6)","E-7":"Chief Petty Officer (E-7)","E-8":"Senior Chief Petty Officer (E-8)","E-9":"Master Chief Petty Officer (E-9)"};
      const GEN ={"E-1":"Junior Enlisted (E-1)","E-2":"Junior Enlisted (E-2)","E-3":"Junior Enlisted (E-3)","E-4":"Corporal/Specialist (E-4)","E-5":"Sergeant (E-5)","E-6":"Staff/Technical Sergeant (E-6)","E-7":"Senior NCO (E-7)","E-8":"Senior NCO (E-8)","E-9":"Senior NCO (E-9)"};
      if (!p) return null;
      if (OFF[p]) return OFF[p];
      if (WARR[p]) return WARR[p];
      if (b.includes('air') || b.includes('space')) return AF[p] || null;
      if (b.includes('army')) return ARMY[p] || null;
      if (b.includes('navy') || b.includes('marine')) return NAVYMC[p] || null;
      if (b.includes('coast')) return CG[p] || null;
      return GEN[p] || p;
    }
    /* ---------- bridge ---------- */
    const getSummarizeURL=()=> (document.getElementById('fid-memo')?.dataset?.summarize||'').trim();
    let bridge = null;
    try { const raw = localStorage.getItem('realtysass.bridge'); if (raw) bridge = JSON.parse(raw); } catch(e){}
    if (!bridge && location.hash){
      const m = location.hash.match(/(?:^|#|&)rsb=([A-Za-z0-9\-_]+)/);
      if (m){ try{ const json = decodeURIComponent(escape(atob(m[1].replace(/-/g,'+').replace(/_/g,'/')))); bridge = JSON.parse(json);}catch(e){} }
    }
    window.addEventListener('message', (ev)=>{
      try{ const msg = ev.data || {}; if (msg.type==='realtysass-bridge' && msg.payload){ bridge=msg.payload; paint(); } }catch(e){}
    }, false);
    /* ---------- snapshot ---------- */
    function snapshotFromBridge(){
      const b = bridge || {};
      const income   = Number(b.income)||0;
      const expenses = Number(b.expenses)||0;
      const savings  = Number(b.savings)||0;
      let housing = Number(b.housing)||0;
      let pAndI   = Number(b.pAndI)||0;
      const price = Number(b.price)||0;
      const dpPct = Number(b.dpPct)||0;
      const dpAmt = Number(b.dpAmt) || (price * (dpPct/100));
      const apr   = Number(b.apr)|| scoreAPR(Number(b.creditScore)||720);
      const termY = Number(b.termYears)||30;
      const tihoa = Number(b.tihoa)||0;
      const pmi   = Number(b.pmi)||0;
      if (!housing){
        const loan  = Math.max(0, price - dpAmt);
        const mRate = (apr/100)/12;
        const termN = Math.max(1, termY*12);
        pAndI = loan>0 ? pmti(loan, mRate, termN) : 0;
        housing = pAndI + tihoa + pmi;
      }
      const freePost = income - expenses - savings - housing;
      return {
        income, expenses, savings, housing, freePost,
        price, dpPct, dpAmt, apr, creditScore:Number(b.creditScore)||720, termYears:termY,
        tihoa, pmi, pAndI,
        totalShare: income>0 ? (expenses+savings+housing)/income : 1,
        housingShare: income>0 ? housing/income : 1,
        dti: income>0 ? (expenses+housing)/income : 1,
        coverage: expenses>0 ? income/expenses : (income>0?Infinity:0),
        runwayMonths: expenses>0 ? (savings/expenses) : 0,
        profile: b.profile || {},
        military: b.military || {}
      };
    }
    /* ---------- buckets summary (bugfix) ---------- */
    function bucketsFromBridge(){
      try{
        const rows = Array.isArray(bridge?.itemizedRows) ? bridge.itemizedRows : JSON.parse(localStorage.getItem('va.expenses.rows')||'[]');
        if (!rows?.length) return {};
        const sums = {};
        rows.forEach(r=>{
          const k = String(r.cat||'Other');
          const v = Number(r.amount||r.monthly||0) || 0;
          sums[k] = (sums[k]||0) + v; // fixed key name
        });
        return sums;
      }catch(_){ return {}; }
    }
    /* ---------- local synthesis (A+ helpful) ---------- */
    function synthesizeFiveFromSnapshot(s, who){
      const last = lastNameOf(who.name);
      const rankNice = rankFriendly(who.rank, who.branch) || 'Service Member';
      const houPct = s.income>0 ? (s.housing/s.income)*100 : 0;
      const dtiPct = s.income>0 ? ((s.expenses+s.housing)/s.income)*100 : 0;
      const {letter} = gradeLocal(s);
      const cov = (s.coverage===Infinity)?'∞':(s.coverage||0).toFixed(2)+'×';
      const runway = (s.runwayMonths||0).toFixed(2);
      // Targets & ranges
      const laneMin = s.income*0.28, laneMax = s.income*0.33;
      const minReserve = Math.max(3, Math.ceil(s.runwayMonths<3?3:s.runwayMonths)); // show 3–6 in prose
      const autoSave = Math.max(50, Math.round(s.income*0.10)); // 10% default autosave suggestion
      // Example re-allocation: take 10% of income from discretionary → savings until 3–6 mo runway
      const discShift = Math.round(s.income*0.10);
      const p1 = `<p><strong>${(rankNice.split(' (')[0])} ${last}</strong>, thank you for your service. This executive memo provides a precise, plain-English readout of your financial health, key risks, and the steps to correct them. With income <strong>${cur(s.income,0)}</strong>, expenses <strong>${cur(s.expenses,0)}</strong>, programmed savings <strong>${cur(s.savings,0)}</strong>, housing <strong>${cur(s.housing,0)}</strong> (~${houPct.toFixed(0)}%), DTI ~<strong>${dtiPct.toFixed(0)}%</strong>, coverage <strong>${cov}</strong>, and runway ~<strong>${runway} months</strong>, your current grade reads <strong>${letter}</strong>.</p>`;
      const p2 = `<p><strong>Financial Health—Concrete Targets.</strong> Keep housing in the <strong>28–33%</strong> lane: today that equals <strong>${cur(laneMin,0)}–${cur(laneMax,0)}</strong> per month all-in (P&I + taxes/insurance/HOA/PMI). Disposable income (income minus expenses, programmed savings, and housing) must stay positive; aim for <strong>≥10%</strong> of income left over after all bills. Set an automatic transfer of <strong>${cur(autoSave,0)}</strong> on payday to build a <strong>3–6 month</strong> reserve; pause only when runway exceeds 3 months. If the projected mortgage pushes housing above ${cur(laneMax,0)} or DTI beyond <strong>43%</strong>, lower price or raise down payment before shopping rate.</p>`;
      const p3 = `<p><strong>Biggest Issues Observed.</strong> The grade is most sensitive to high DTI and a thin runway. Credit score tiers directly move APR and payment; each tier can swing monthly cost by <strong>$75–$200+</strong> at today’s prices. If discretionary categories (e.g., dining, subscriptions, rideshare) routinely exceed <strong>10–12%</strong> of income, they suppress savings velocity and raise risk. Lack of housing contribution today means any purchase must be sized into the lane above.</p>`;
      const p4 = `<p><strong>Improvement Playbook (Do This Next).</strong> 1) Pull free reports at <a href="https://www.annualcreditreport.com" target="_blank" rel="noopener">annualcreditreport.com</a>; dispute errors and drive utilization under <strong>30%</strong> (ideal <strong>&lt;10%</strong>) using a “lowest-APR ladder” payoff. 2) Reallocate ~<strong>${cur(discShift,0)}</strong>/mo from discretionary to your autopay reserve until you reach <strong>3–6 months</strong>. 3) Keep total commitments ≤ <strong>70%</strong> of income; if above, pay down the highest-payment, lowest-term debts first (DTI relief). 4) When offering on a home, pair a price target sized to <strong>${cur(laneMin,0)}–${cur(laneMax,0)}</strong> with <em>seller credits</em> for closing costs; weigh points vs. lender credits to optimize cash vs. rate. See CFPB guidance at <a href="https://www.consumerfinance.gov/" target="_blank" rel="noopener">cfpb.gov</a>.</p>`;
      const p5 = `<p><strong>Closing & Next Steps.</strong> We’ll translate these targets into a pre-approval brief, then run property scenarios inside the housing lane, sequencing COE → underwriting → lock strategy → curated inventory. I will refresh this memo as your live numbers improve so you purchase with confidence.</p>`;
      return [p1,p2,p3,p4,p5].join('');
    }
    /* ---------- sanitize: enforce five <p> blocks ---------- */
    function enforceFive(html, fallbackHTML){
      const d=document.createElement('div'); d.innerHTML=html||'';
      let paras = Array.from(d.querySelectorAll('p')).map(p=>p.innerHTML.trim()).filter(Boolean);
      if (paras.length < 5 && fallbackHTML){
        const d2=document.createElement('div'); d2.innerHTML=fallbackHTML;
        paras = Array.from(d2.querySelectorAll('p')).map(p=>p.innerHTML.trim()).filter(Boolean);
      }
      while (paras.length < 5) paras.push('');
      if (paras.length > 5) paras = paras.slice(0,5);
      return paras.map(t=>`<p>${t}</p>`).join('');
    }
    /* ---------- server call ---------- */
    async function fetchAIMemo(snapshot, totals, who){
      const url = getSummarizeURL();
      if (!url) return { error:'No summarize URL set' };
      const styleGuide = {
        persona: { name:"Elena, Virtual Concierge",
          role:"Executive Finance & Real Estate Strategist (CEO voice)",
          pedigree:"Harvard-trained, VA-loan specialist, boardroom communicator",
          voice:["Crisp, confident, data-forward","Plain English with banker precision","No slang, no emojis, no fluff"],
          audience: who.name || "Client"
        },
        purpose: "Five-paragraph CEO-grade memo: purpose, detailed financial health & grade with DOLLAR TARGETS, biggest issues, improvement playbook with LINKS, closing/next steps.",
        structure: [
          "P1 – Rank + Last Name greeting; state purpose and headline figures.",
          "P2 – Concrete targets: housing 28–33% with dollar range, DI >=10%, autopay reserve amount with dollars, exact DTI guardrails.",
          "P3 – Biggest issues (credit tiers effect in $/mo, runway shortfall, discretionary %), specific to live numbers.",
          "P4 – Improvement Playbook: utilization ladder, dispute flow, debt sequencing, seller credits/points tactics, links.",
          "P5 – Closing & next steps."
        ],
        formatting: { paragraphs:5, bullets:"none", boldKeyNumbers:true, currency:"USD, whole dollars", readingLevel:"executive" }
      };
      try{
        const res = await fetch(url, { method:'POST', headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ kind:'fiduciary-memo', snapshot, buckets: totals, styleGuide }) });
        if(!res.ok) throw new Error('HTTP '+res.status);
        return await res.json();
      }catch(e){ return { error:String(e.message||e) }; }
    }
    function setNote(state, text){
      const note=$('#memo-note');
      note.classList.remove('loading','error','success');
      note.classList.add(state);
      note.textContent = text;
    }
    /* ---------- paint ---------- */
    function paint(){
      const s = snapshotFromBridge();
      const who = extractIdentity(bridge||{});
      $('#memo-client').textContent = `Client: ${who.name || 'Client'}${who.email? ' • '+who.email : ''}`;
      try{ $('#memo-date').textContent = new Date().toLocaleDateString(undefined,{year:'numeric',month:'long',day:'numeric'});}catch(_){}
      const totals = bucketsFromBridge();
      const localFive = synthesizeFiveFromSnapshot(s, who); // strong local memo
      $('#memo-body').innerHTML = localFive;
      setNote('loading','Preparing AI memo…');
      (async ()=>{
        const ai = await fetchAIMemo(s, totals, who);
        if (ai?.memoHtml){
          const html = enforceFive(ai.memoHtml, localFive);
          $('#memo-body').innerHTML = html;
          setNote('success','AI memo generated via Netlify (OpenAI).');
        } else if (ai?.memo){
          const html = enforceFive(`<p>${String(ai.memo)}</p>`, localFive);
          $('#memo-body').innerHTML = html;
          setNote('success','AI memo generated via Netlify (OpenAI).');
        } else {
          $('#memo-body').innerHTML = localFive;
          setNote('error', `AI memo failed (${ai?.error||'unknown reason'}). Showing local executive analysis.`);
        }
      })();
    }
    /* ---------- controls ---------- */
    $('#memo-refresh').addEventListener('click', paint);
    $('#memo-print').addEventListener('click', ()=> window.print());
    /* boot */
    paint();
  })();
  </script>
        </div>
    </5)></div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=68cecb820ec3dbdca3ef9099" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../js/webflow.js" type="text/javascript"></script>
</body>
</html>